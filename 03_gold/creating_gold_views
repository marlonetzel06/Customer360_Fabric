
-- Creates Gold Schema
CREATE SCHEMA gold;

GO

-----------------------------------------------------------------------
-- Gold-View für dim_Kontakte
----------------------------------------------------------------------- 

CREATE OR ALTER VIEW gold.dim_Kontakte AS
SELECT
   kt.Kontakt_sk,
   kt.Kontakt_ID,
   ku.Kunde_sk,
   kt.Name,
   kt.Email,
   kt.Position
FROM silver.silver_kontakte AS kt
LEFT JOIN silver.silver_Kunden ku
    ON kt.Kunden_ID = ku.Kunden_ID;

GO

-----------------------------------------------------------------------
-- Gold-View für dim_Kunden
----------------------------------------------------------------------- 

CREATE OR ALTER VIEW gold.dim_Kunden AS
SELECT
    Kunden_ID,
    Kunde_sk,
    Kundenname,
    Land,
    Umsatzklasse,
    Branche
FROM silver.silver_Kunden;

GO 

-----------------------------------------------------------------------
-- Gold-View für dim_Mitarbeiter
----------------------------------------------------------------------- 

CREATE OR ALTER VIEW gold.dim_Mitarbeiter AS
SELECT
    Mitarbeiter_ID,
    Mitarbeiter_sk,
    Name, 
    Abteilung, 
    Rolle, 
    Einstellungsdatum, 
    Gehalt
FROM silver.silver_Mitarbeiter;

GO

-----------------------------------------------------------------------
-- Gold-View für dim_Projekt
----------------------------------------------------------------------- 

CREATE OR ALTER VIEW gold.dim_Projekte AS
SELECT 
    p.Projekt_ID AS Projekt_id,
    k.Kunde_sk AS Kunden_sk,
    s.Service_sk AS Service_sk,
    p.Projektname AS Projektname,
    p.Startdatum AS Projektstart,
    p.Enddatum  AS Projektende,
    p.Budget_EUR AS Projektbudget,
    p.Projektstatus AS Projektstatus
FROM silver.silver_Projekte AS p
LEFT JOIN gold.dim_Kunden AS k
    ON k.Kunden_ID = p.KUNDEN_ID
LEFT JOIN gold.dim_service AS s
    ON s.Service_ID = p.Service_ID;

GO

-----------------------------------------------------------------------
-- Gold-View für dim_Service
----------------------------------------------------------------------- 


CREATE OR ALTER VIEW gold.dim_service AS
SELECT
    Service_ID,
    Service_sk,
    Service_Name,
    Kategorie,
    Preis_pro_Stunde
FROM silver.silver_Service;

GO

DROP VIEW IF EXISTS gold.dim_service;

-----------------------------------------------------------------------
-- Gold-View für fct_Transactionen
----------------------------------------------------------------------- 

CREATE OR ALTER VIEW gold.fct_transactions AS
SELECT
t.Transaktion_ID,
k.Kunde_sk,
t.Service,
t.Betrag_EUR,
t.Transaktionsdatum,
t.Status,
t.Quellsystem
FROM silver.silver_transactions_all t
LEFT JOIN gold.dim_Kunden AS k
    ON t.Kunden_ID = k.Kunden_ID;

GO
